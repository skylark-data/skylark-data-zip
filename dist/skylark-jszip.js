/**
 * skylark-jszip - A skylark wrapper for jszip.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
!function(e,t){var r=t.define,require=t.require,i="function"==typeof r&&r.amd,n=!i&&"undefined"!=typeof exports;if(!i&&!r){var s={};r=t.define=function(e,t,r){"function"==typeof r?(s[e]={factory:r,deps:t.map(function(t){return function(e,t){if("."!==e[0])return e;var r=t.split("/"),i=e.split("/");r.pop();for(var n=0;n<i.length;n++)"."!=i[n]&&(".."==i[n]?r.pop():r.push(i[n]));return r.join("/")}(t,e)}),resolved:!1,exports:null},require(e)):s[e]={factory:null,resolved:!0,exports:r}},require=t.require=function(e){if(!s.hasOwnProperty(e))throw new Error("Module "+e+" has not been defined");var module=s[e];if(!module.resolved){var r=[];module.deps.forEach(function(e){r.push(require(e))}),module.exports=module.factory.apply(t,r)||null,module.resolved=!0}return module.exports}}if(!r)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(e,require){e("skylark-langx-binary/Buffer",["./memory"],function(e){return e}),e("skylark-jszip/support",["skylark-langx-binary/Buffer"],function(e){"use strict";var t={base64:!0,array:!0,string:!0};if(t.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,t.nodebuffer=t.buffer=!0,t.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)t.blob=!1;else{var r=new ArrayBuffer(0);try{t.blob=0===new Blob([r],{type:"application/zip"}).size}catch(e){try{var i=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,n=new i;n.append(r),t.blob=0===n.getBlob("application/zip").size}catch(e){t.blob=!1}}}return t.getTypeOf=function(r){return"string"==typeof r?"string":"[object Array]"===Object.prototype.toString.call(r)?"array":t.nodebuffer&&e.isBuffer(r)?"nodebuffer":t.uint8array&&r instanceof Uint8Array?"uint8array":t.arraybuffer&&r instanceof ArrayBuffer?"arraybuffer":void 0},t}),e("skylark-jszip/base64",["./support"],function(e){"use strict";var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(r){var i,n,s,o,a,u,h,c=[],l=0,d=r.length,f=d,p="string"!==e.getTypeOf(r);for(;l<r.length;)f=d-l,p?(i=r[l++],n=l<d?r[l++]:0,s=l<d?r[l++]:0):(i=r.charCodeAt(l++),n=l<d?r.charCodeAt(l++):0,s=l<d?r.charCodeAt(l++):0),o=i>>2,a=(3&i)<<4|n>>4,u=f>1?(15&n)<<2|s>>6:64,h=f>2?63&s:64,c.push(t.charAt(o)+t.charAt(a)+t.charAt(u)+t.charAt(h));return c.join("")},decode:function(r){var i,n,s,o,a,u,h,c=0,l=0;if("data:"===r.substr(0,"data:".length))throw new Error("Invalid base64 input, it looks like a data url.");var d,f=3*(r=r.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;r.charAt(r.length-1)===t.charAt(64)&&f--;r.charAt(r.length-2)===t.charAt(64)&&f--;if(f%1!=0)throw new Error("Invalid base64 input, bad content length.");d=e.uint8array?new Uint8Array(0|f):new Array(0|f);for(;c<r.length;)o=t.indexOf(r.charAt(c++)),a=t.indexOf(r.charAt(c++)),u=t.indexOf(r.charAt(c++)),h=t.indexOf(r.charAt(c++)),i=o<<2|a>>4,n=(15&a)<<4|u>>2,s=(3&u)<<6|h,d[l++]=i,64!==u&&(d[l++]=n),64!==h&&(d[l++]=s);return d}}}),e("skylark-jszip/external",[],function(){"use strict";return{Promise:Promise}}),e("skylark-jszip/utils",["skylark-langx-binary/buffer","skylark-langx-binary/transform","skylark-langx-binary/arraylike-to-string","skylark-langx-constructs","./support","./base64","./external"],function(e,t,r,i,n,s,o){"use strict";var a={newBlob:function(e,t){a.checkSupport("blob");try{return new Blob([e],{type:t})}catch(n){try{var r=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,i=new r;return i.append(e),i.getBlob(t)}catch(e){throw new Error("Bug : can't construct the Blob.")}}}};return a.applyFromCharCode=r,a.transformTo=function(e,r){return"nodebuffer"==e&&(e="memory"),t(e,r)},a.resolve=function(e){for(var t=e.split("/"),r=[],i=0;i<t.length;i++){var n=t[i];"."===n||""===n&&0!==i&&i!==t.length-1||(".."===n?r.pop():r.push(n))}return r.join("/")},a.getTypeOf=n.getTypeOf,a.checkSupport=function(e){var t=n[e.toLowerCase()];if(!t)throw new Error(e+" is not supported by this platform")},a.MAX_VALUE_16BITS=65535,a.MAX_VALUE_32BITS=-1,a.pretty=function(e){var t,r,i="";for(r=0;r<(e||"").length;r++)t=e.charCodeAt(r),i+="\\x"+(t<16?"0":"")+t.toString(16).toUpperCase();return i},a.delay=function(e,t,r){setTimeout(function(){e.apply(r||null,t||[])})},a.inherits=function(e,t){var r=function(){};r.prototype=t.prototype,e.prototype=new r},a.extend=function(){var e,t,r={};for(e=0;e<arguments.length;e++)for(t in arguments[e])Object.prototype.hasOwnProperty.call(arguments[e],t)&&void 0===r[t]&&(r[t]=arguments[e][t]);return r},a.prepareContent=function(e,t,r,i,u){var h=o.Promise.resolve(t).then(function(e){var t=n.blob&&(e instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(e)));return t&&"undefined"!=typeof FileReader?new o.Promise(function(t,r){var i=new FileReader;i.onload=function(e){t(e.target.result)},i.onerror=function(e){r(e.target.error)},i.readAsArrayBuffer(e)}):e});return h.then(function(t){var n=a.getTypeOf(t);return n?("arraybuffer"===n?t=a.transformTo("uint8array",t):"string"===n&&(u?t=s.decode(t):r&&!0!==i&&(t=string2binary(t))),t):o.Promise.reject(new Error("Can't read the data of '"+e+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})},a}),e("skylark-jszip/stream/GenericWorker",[],function(){"use strict";function e(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}return e.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var r=0;r<this._listeners[e].length;r++)this._listeners[e][r].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",function(e){t.processChunk(e)}),e.on("end",function(){t.end()}),e.on("error",function(e){t.error(e)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var e=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},e}),e("skylark-jszip/utf8",["skylark-langx-binary/buffer","./utils","./support","./stream/GenericWorker"],function(e,t,r,i){"use strict";for(var n={},s=new Array(256),o=0;o<256;o++)s[o]=o>=252?6:o>=248?5:o>=240?4:o>=224?3:o>=192?2:1;s[254]=s[254]=1;function a(){i.call(this,"utf-8 decode"),this.leftOver=null}function u(){i.call(this,"utf-8 encode")}return n.utf8encode=function(t){return r.nodebuffer?e.from(t,"utf-8"):function(e){var t,i,n,s,o,a=e.length,u=0;for(s=0;s<a;s++)55296==(64512&(i=e.charCodeAt(s)))&&s+1<a&&56320==(64512&(n=e.charCodeAt(s+1)))&&(i=65536+(i-55296<<10)+(n-56320),s++),u+=i<128?1:i<2048?2:i<65536?3:4;t=r.uint8array?new Uint8Array(u):new Array(u);for(o=0,s=0;o<u;s++)55296==(64512&(i=e.charCodeAt(s)))&&s+1<a&&56320==(64512&(n=e.charCodeAt(s+1)))&&(i=65536+(i-55296<<10)+(n-56320),s++),i<128?t[o++]=i:i<2048?(t[o++]=192|i>>>6,t[o++]=128|63&i):i<65536?(t[o++]=224|i>>>12,t[o++]=128|i>>>6&63,t[o++]=128|63&i):(t[o++]=240|i>>>18,t[o++]=128|i>>>12&63,t[o++]=128|i>>>6&63,t[o++]=128|63&i);return t}(t)},n.utf8decode=function(e){return r.nodebuffer?t.transformTo("nodebuffer",e).toString("utf-8"):function(e){var r,i,n,o,a=e.length,u=new Array(2*a);for(i=0,r=0;r<a;)if((n=e[r++])<128)u[i++]=n;else if((o=s[n])>4)u[i++]=65533,r+=o-1;else{for(n&=2===o?31:3===o?15:7;o>1&&r<a;)n=n<<6|63&e[r++],o--;o>1?u[i++]=65533:n<65536?u[i++]=n:(n-=65536,u[i++]=55296|n>>10&1023,u[i++]=56320|1023&n)}u.length!==i&&(u.subarray?u=u.subarray(0,i):u.length=i);return t.applyFromCharCode(u)}(e=t.transformTo(r.uint8array?"uint8array":"array",e))},t.inherits(a,i),a.prototype.processChunk=function(e){var i=t.transformTo(r.uint8array?"uint8array":"array",e.data);if(this.leftOver&&this.leftOver.length){if(r.uint8array){var o=i;(i=new Uint8Array(o.length+this.leftOver.length)).set(this.leftOver,0),i.set(o,this.leftOver.length)}else i=this.leftOver.concat(i);this.leftOver=null}var a=function(e,t){var r;(t=t||e.length)>e.length&&(t=e.length);r=t-1;for(;r>=0&&128==(192&e[r]);)r--;if(r<0)return t;if(0===r)return t;return r+s[e[r]]>t?r:t}(i),u=i;a!==i.length&&(r.uint8array?(u=i.subarray(0,a),this.leftOver=i.subarray(a,i.length)):(u=i.slice(0,a),this.leftOver=i.slice(a,i.length))),this.push({data:n.utf8decode(u),meta:e.meta})},a.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=a,t.inherits(u,i),u.prototype.processChunk=function(e){this.push({data:n.utf8encode(e.data),meta:e.meta})},n.Utf8EncodeWorker=u,n}),e("skylark-jszip/stream/ConvertWorker",["./GenericWorker","../utils"],function(e,t){"use strict";function r(t){e.call(this,"ConvertWorker to "+t),this.destType=t}return t.inherits(r,e),r.prototype.processChunk=function(e){this.push({data:t.transformTo(this.destType,e.data),meta:e.meta})},r}),e("skylark-jszip/stream/StreamHelper",["../utils","./ConvertWorker","./GenericWorker","../base64","../support","../external"],function(e,t,r,i,n,s){"use strict";function o(t,r){return new s.Promise(function(n,s){var o=[],a=t._internalType,u=t._outputType,h=t._mimeType;t.on("data",function(e,t){o.push(e),r&&r(t)}).on("error",function(e){o=[],s(e)}).on("end",function(){try{var t=function(t,r,n){switch(t){case"blob":return e.newBlob(e.transformTo("arraybuffer",r),n);case"base64":return i.encode(r);default:return e.transformTo(t,r)}}(u,function(e,t){var r,i=0,n=null,s=0;for(r=0;r<t.length;r++)s+=t[r].length;switch(e){case"string":return t.join("");case"array":return Array.prototype.concat.apply([],t);case"uint8array":for(n=new Uint8Array(s),r=0;r<t.length;r++)n.set(t[r],i),i+=t[r].length;return n;case"nodebuffer":return Buffer.concat(t);default:throw new Error("concat : unsupported type '"+e+"'")}}(a,o),h);n(t)}catch(e){s(e)}o=[]}).resume()})}function a(i,n,s){var o=n;switch(n){case"blob":case"arraybuffer":o="uint8array";break;case"base64":o="string"}try{this._internalType=o,this._outputType=n,this._mimeType=s,e.checkSupport(o),this._worker=i.pipe(new t(o)),i.lock()}catch(e){this._worker=new r("error"),this._worker.error(e)}}return a.prototype={accumulate:function(e){return o(this,e)},on:function(t,r){var i=this;return"data"===t?this._worker.on(t,function(e){r.call(i,e.data,e.meta)}):this._worker.on(t,function(){e.delay(r,arguments,i)}),this},resume:function(){return e.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(t){if(e.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new NodejsStreamOutputAdapter(this,{objectMode:"nodebuffer"!==this._outputType},t)}},a}),e("skylark-jszip/defaults",[],function(){"use strict";var exports={},module={exports:{}};function e(e){return"object"!=typeof e||Array.isArray(e)||!function(e){var t;for(t in e)return!1;return!0}(e)}return exports.base64=!1,exports.binary=!1,exports.dir=!1,exports.createFolders=!0,exports.date=null,exports.compression=null,exports.compressionOptions=null,exports.comment=null,exports.unixPermissions=null,exports.dosPermissions=null,e(module.exports)?module.exports:e(exports)?exports:void 0}),e("skylark-jszip/stream/DataWorker",["../utils","./GenericWorker"],function(e,t){"use strict";function r(r){t.call(this,"DataWorker");var i=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,r.then(function(t){i.dataIsReady=!0,i.data=t,i.max=t&&t.length||0,i.type=e.getTypeOf(t),i.isPaused||i._tickAndRepeat()},function(e){i.error(e)})}return e.inherits(r,t),r.prototype.cleanUp=function(){t.prototype.cleanUp.call(this),this.data=null},r.prototype.resume=function(){return!!t.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,e.delay(this._tickAndRepeat,[],this)),!0)},r.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(e.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},r.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=null,t=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":e=this.data.substring(this.index,t);break;case"uint8array":e=this.data.subarray(this.index,t);break;case"array":case"nodebuffer":e=this.data.slice(this.index,t)}return this.index=t,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})},r}),e("skylark-jszip/crc32",["./utils"],function(e){"use strict";var t=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();return function(r,i){if(void 0===r||!r.length)return 0;return"string"!==e.getTypeOf(r)?function(e,r,i,n){var s=t,o=n+i;e^=-1;for(var a=n;a<o;a++)e=e>>>8^s[255&(e^r[a])];return-1^e}(0|i,r,r.length,0):function(e,r,i,n){var s=t,o=n+i;e^=-1;for(var a=n;a<o;a++)e=e>>>8^s[255&(e^r.charCodeAt(a))];return-1^e}(0|i,r,r.length,0)}}),e("skylark-jszip/stream/Crc32Probe",["./GenericWorker","../crc32","../utils"],function(e,t,r){"use strict";function i(){e.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}return r.inherits(i,e),i.prototype.processChunk=function(e){this.streamInfo.crc32=t(e.data,this.streamInfo.crc32||0),this.push(e)},i}),e("skylark-jszip/stream/DataLengthProbe",["../utils","./GenericWorker"],function(e,t){"use strict";function r(e){t.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}return e.inherits(r,t),r.prototype.processChunk=function(e){if(e){var r=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=r+e.data.length}t.prototype.processChunk.call(this,e)},r}),e("skylark-jszip/compressedObject",["./external","./stream/DataWorker","./stream/Crc32Probe","./stream/DataLengthProbe"],function(e,t,r,i){"use strict";function n(e,t,r,i,n){this.compressedSize=e,this.uncompressedSize=t,this.crc32=r,this.compression=i,this.compressedContent=n}return n.prototype={getContentWorker:function(){var r=new t(e.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new i("data_length")),n=this;return r.on("end",function(){if(this.streamInfo.data_length!==n.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),r},getCompressedWorker:function(){return new t(e.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},n.createWorkerFrom=function(e,t,n){return e.pipe(new r).pipe(new i("uncompressedSize")).pipe(t.compressWorker(n)).pipe(new i("compressedSize")).withStreamInfo("compression",t)},n}),e("skylark-jszip/zipObject",["./stream/StreamHelper","./stream/DataWorker","./utf8","./compressedObject","./stream/GenericWorker"],function(e,t,r,i,n){"use strict";var s=function(e,t,r){this.name=e,this.dir=r.dir,this.date=r.date,this.comment=r.comment,this.unixPermissions=r.unixPermissions,this.dosPermissions=r.dosPermissions,this._data=t,this._dataBinary=r.binary,this.options={compression:r.compression,compressionOptions:r.compressionOptions}};s.prototype={internalStream:function(t){var i=null,s="string";try{if(!t)throw new Error("No output type specified.");var o="string"===(s=t.toLowerCase())||"text"===s;"binarystring"!==s&&"text"!==s||(s="string"),i=this._decompressWorker();var a=!this._dataBinary;a&&!o&&(i=i.pipe(new r.Utf8EncodeWorker)),!a&&o&&(i=i.pipe(new r.Utf8DecodeWorker))}catch(e){(i=new n("error")).error(e)}return new e(i,s,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){if(this._data instanceof i&&this._data.compression.magic===e.magic)return this._data.getCompressedWorker();var n=this._decompressWorker();return this._dataBinary||(n=n.pipe(new r.Utf8EncodeWorker)),i.createWorkerFrom(n,e,t)},_decompressWorker:function(){return this._data instanceof i?this._data.getContentWorker():this._data instanceof n?this._data:new t(this._data)}};for(var o=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],a=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<o.length;u++)s.prototype[o[u]]=a;return s}),e("skylark-jszip/flate",["skylark-pako","./utils","./stream/GenericWorker"],function(e,t,r){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,n=i?"uint8array":"array",s={};function o(e,t){r.call(this,"FlateWorker/"+e),this._pako=null,this._pakoAction=e,this._pakoOptions=t,this.meta={}}return s.magic="\b\0",t.inherits(o,r),o.prototype.processChunk=function(e){this.meta=e.meta,null===this._pako&&this._createPako(),this._pako.push(t.transformTo(n,e.data),!1)},o.prototype.flush=function(){r.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},o.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this._pako=null},o.prototype._createPako=function(){this._pako=new e[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var t=this;this._pako.onData=function(e){t.push({data:e,meta:t.meta})}},s.compressWorker=function(e){return new o("Deflate",e)},s.uncompressWorker=function(){return new o("Inflate",{})},s}),e("skylark-jszip/compressions",["./stream/GenericWorker","./flate"],function(e,t){"use strict";var r={magic:"\0\0",compressWorker:function(){return new e("STORE compression")},uncompressWorker:function(){return new e("STORE decompression")}};return{STORE:r,DEFLATE:t}}),e("skylark-jszip/signature",[],function(){"use strict";return{LOCAL_FILE_HEADER:"PK",CENTRAL_FILE_HEADER:"PK",CENTRAL_DIRECTORY_END:"PK",ZIP64_CENTRAL_DIRECTORY_LOCATOR:"PK",ZIP64_CENTRAL_DIRECTORY_END:"PK",DATA_DESCRIPTOR:"PK\b"}}),e("skylark-jszip/generate/ZipFileWorker",["../utils","../stream/GenericWorker","../utf8","../crc32","../signature"],function(e,t,r,i,n){"use strict";var s=function(e,t){var r,i="";for(r=0;r<t;r++)i+=String.fromCharCode(255&e),e>>>=8;return i},o=function(t,o,a,u,h,c){var l,d,f=t.file,p=t.compression,m=c!==r.utf8encode,y=e.transformTo("string",c(f.name)),k=e.transformTo("string",r.utf8encode(f.name)),g=f.comment,v=e.transformTo("string",c(g)),S=e.transformTo("string",r.utf8encode(g)),b=k.length!==f.name.length,C=S.length!==g.length,E="",w="",_="",I=f.dir,A=f.date,O={crc32:0,compressedSize:0,uncompressedSize:0};o&&!a||(O.crc32=t.crc32,O.compressedSize=t.compressedSize,O.uncompressedSize=t.uncompressedSize);var z=0;o&&(z|=8),m||!b&&!C||(z|=2048);var x=0,T=0;I&&(x|=16),"UNIX"===h?(T=798,x|=function(e,t){var r=e;e||(r=t?16893:33204);return(65535&r)<<16}(f.unixPermissions,I)):(T=20,x|=63&(f.dosPermissions||0)),l=A.getUTCHours(),l<<=6,l|=A.getUTCMinutes(),l<<=5,l|=A.getUTCSeconds()/2,d=A.getUTCFullYear()-1980,d<<=4,d|=A.getUTCMonth()+1,d<<=5,d|=A.getUTCDate(),b&&(w=s(1,1)+s(i(y),4)+k,E+="up"+s(w.length,2)+w),C&&(_=s(1,1)+s(i(v),4)+S,E+="uc"+s(_.length,2)+_);var R="";R+="\n\0",R+=s(z,2),R+=p.magic,R+=s(l,2),R+=s(d,2),R+=s(O.crc32,4),R+=s(O.compressedSize,4),R+=s(O.uncompressedSize,4),R+=s(y.length,2),R+=s(E.length,2);var F=n.LOCAL_FILE_HEADER+R+y+E,P=n.CENTRAL_FILE_HEADER+s(T,2)+R+s(v.length,2)+"\0\0\0\0"+s(x,4)+s(u,4)+y+E+v;return{fileRecord:F,dirRecord:P}};function a(e,r,i,n){t.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=r,this.zipPlatform=i,this.encodeFileName=n,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}return e.inherits(a,t),a.prototype.push=function(e){var r=e.meta.percent||0,i=this.entriesCount,n=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,t.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:i?(r+100*(i-n-1))/i:100}}))},a.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t=this.streamFiles&&!e.file.dir;if(t){var r=o(e,t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:r.fileRecord,meta:{percent:0}})}else this.accumulate=!0},a.prototype.closedSource=function(e){this.accumulate=!1;var t=this.streamFiles&&!e.file.dir,r=o(e,t,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(r.dirRecord),t)this.push({data:function(e){return n.DATA_DESCRIPTOR+s(e.crc32,4)+s(e.compressedSize,4)+s(e.uncompressedSize,4)}(e),meta:{percent:100}});else for(this.push({data:r.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},a.prototype.flush=function(){for(var t=this.bytesWritten,r=0;r<this.dirRecords.length;r++)this.push({data:this.dirRecords[r],meta:{percent:100}});var i=this.bytesWritten-t,o=function(t,r,i,o,a){var u=e.transformTo("string",a(o));return n.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(t,2)+s(t,2)+s(r,4)+s(i,4)+s(u.length,2)+u}(this.dirRecords.length,i,t,this.zipComment,this.encodeFileName);this.push({data:o,meta:{percent:100}})},a.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},a.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",function(e){t.processChunk(e)}),e.on("end",function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()}),e.on("error",function(e){t.error(e)}),this},a.prototype.resume=function(){return!!t.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},a.prototype.error=function(e){var r=this._sources;if(!t.prototype.error.call(this,e))return!1;for(var i=0;i<r.length;i++)try{r[i].error(e)}catch(e){}return!0},a.prototype.lock=function(){t.prototype.lock.call(this);for(var e=this._sources,r=0;r<e.length;r++)e[r].lock()},a}),e("skylark-jszip/generate",["./compressions","./generate/ZipFileWorker"],function(e,t){"use strict";var r=function(t,r){var i=t||r,n=e[i];if(!n)throw new Error(i+" is not a valid compression method !");return n};return function(e,i,n){var s=new t(i.streamFiles,n,i.platform,i.encodeFileName),o=0;try{e.forEach(function(e,t){o++;var n=r(t.options.compression,i.compression),a=t.options.compressionOptions||i.compressionOptions||{},u=t.dir,h=t.date;t._compressWorker(n,a).withStreamInfo("file",{name:e,dir:u,date:h,comment:t.comment||"",unixPermissions:t.unixPermissions,dosPermissions:t.dosPermissions}).pipe(s)}),s.entriesCount=o}catch(e){s.error(e)}return s}}),e("skylark-jszip/object",["./utf8","./utils","./stream/GenericWorker","./stream/StreamHelper","./defaults","./compressedObject","./zipObject","./generate"],function(e,t,r,i,n,s,o,a){"use strict";var u=function(e,i,a){var u,d=t.getTypeOf(i),f=t.extend(a||{},n);f.date=f.date||new Date,null!==f.compression&&(f.compression=f.compression.toUpperCase()),"string"==typeof f.unixPermissions&&(f.unixPermissions=parseInt(f.unixPermissions,8)),f.unixPermissions&&16384&f.unixPermissions&&(f.dir=!0),f.dosPermissions&&16&f.dosPermissions&&(f.dir=!0),f.dir&&(e=c(e)),f.createFolders&&(u=h(e))&&l.call(this,u,!0);var p="string"===d&&!1===f.binary&&!1===f.base64;a&&void 0!==a.binary||(f.binary=!p);var m=i instanceof s&&0===i.uncompressedSize;(m||f.dir||!i||0===i.length)&&(f.base64=!1,f.binary=!0,i="",f.compression="STORE",d="string");var y=null;y=i instanceof s||i instanceof r?i:t.prepareContent(e,i,f.binary,f.optimizedBinaryString,f.base64);var k=new o(e,y,f);this.files[e]=k},h=function(e){"/"===e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""},c=function(e){return"/"!==e.slice(-1)&&(e+="/"),e},l=function(e,t){return t=void 0!==t?t:n.createFolders,e=c(e),this.files[e]||u.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]};function d(e){return"[object RegExp]"===Object.prototype.toString.call(e)}var f={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,r,i;for(t in this.files)i=this.files[t],(r=t.slice(this.root.length,t.length))&&t.slice(0,this.root.length)===this.root&&e(r,i)},filter:function(e){var t=[];return this.forEach(function(r,i){e(r,i)&&t.push(i)}),t},file:function(e,t,r){if(1===arguments.length){if(d(e)){var i=e;return this.filter(function(e,t){return!t.dir&&i.test(e)})}var n=this.files[this.root+e];return n&&!n.dir?n:null}return e=this.root+e,u.call(this,e,t,r),this},folder:function(e){if(!e)return this;if(d(e))return this.filter(function(t,r){return r.dir&&e.test(t)});var t=this.root+e,r=l.call(this,t),i=this.clone();return i.root=r.name,i},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!==e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var r=this.filter(function(t,r){return r.name.slice(0,e.length)===e}),i=0;i<r.length;i++)delete this.files[r[i].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(n){var s,o={};try{if((o=t.extend(n||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:e.utf8encode})).type=o.type.toLowerCase(),o.compression=o.compression.toUpperCase(),"binarystring"===o.type&&(o.type="string"),!o.type)throw new Error("No output type specified.");t.checkSupport(o.type),"darwin"!==o.platform&&"freebsd"!==o.platform&&"linux"!==o.platform&&"sunos"!==o.platform||(o.platform="UNIX"),"win32"===o.platform&&(o.platform="DOS");var u=o.comment||this.comment||"";s=a.generateWorker(this,o,u)}catch(e){(s=new r("error")).error(e)}return new i(s,o.type||"string",o.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return(e=e||{}).type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}};return f}),e("skylark-jszip/reader/ArrayReader",["skylark-io-readers/array-reader"],function(e){"use strict";return e}),e("skylark-jszip/reader/StringReader",["skylark-io-readers/string-reader"],function(e){"use strict";return e}),e("skylark-jszip/reader/NodeBufferReader",["skylark-io-readers/buffer-reader"],function(e){"use strict";return e}),e("skylark-jszip/reader/Uint8ArrayReader",["skylark-io-readers/uint8-array-reader"],function(e){"use strict";return e}),e("skylark-jszip/reader/readerFor",["../utils","../support","./ArrayReader","./StringReader","./NodeBufferReader","./Uint8ArrayReader"],function(e,t,r,i,n,s){"use strict";return function(o){var a=e.getTypeOf(o);if(e.checkSupport(a),"string"===a&&!t.uint8array)return new i(o);if("nodebuffer"===a)return new n(o);if(t.uint8array)return new s(e.transformTo("uint8array",o));return new r(e.transformTo("array",o))}}),e("skylark-jszip/zipEntry",["./reader/readerFor","./utils","./compressedObject","./crc32","./utf8","./compressions","./support"],function(e,t,r,i,n,s,o){"use strict";function a(e,t){this.options=e,this.loadOptions=t}return a.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(e){var i,n;if(e.skip(22),this.fileNameLength=e.readInt(2),n=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(n),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(i=function(e){for(var t in s)if(Object.prototype.hasOwnProperty.call(s,t)&&s[t].magic===e)return s[t];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+t.pretty(this.compressionMethod)+" unknown (inner file : "+t.transformTo("string",this.fileName)+")");this.decompressed=new r(this.compressedSize,this.uncompressedSize,this.crc32,i,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0===e&&(this.dosPermissions=63&this.externalFileAttributes),3===e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var r=e(this.extraFields[1].value);this.uncompressedSize===t.MAX_VALUE_32BITS&&(this.uncompressedSize=r.readInt(8)),this.compressedSize===t.MAX_VALUE_32BITS&&(this.compressedSize=r.readInt(8)),this.localHeaderOffset===t.MAX_VALUE_32BITS&&(this.localHeaderOffset=r.readInt(8)),this.diskNumberStart===t.MAX_VALUE_32BITS&&(this.diskNumberStart=r.readInt(4))}},readExtraFields:function(e){var t,r,i,n=e.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});e.index+4<n;)t=e.readInt(2),r=e.readInt(2),i=e.readData(r),this.extraFields[t]={id:t,length:r,value:i};e.setIndex(n)},handleUTF8:function(){var e=o.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=n.utf8decode(this.fileName),this.fileCommentStr=n.utf8decode(this.fileComment);else{var r=this.findExtraFieldUnicodePath();if(null!==r)this.fileNameStr=r;else{var i=t.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(i)}var s=this.findExtraFieldUnicodeComment();if(null!==s)this.fileCommentStr=s;else{var a=t.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(a)}}},findExtraFieldUnicodePath:function(){var t=this.extraFields[28789];if(t){var r=e(t.value);return 1!==r.readInt(1)?null:i(this.fileName)!==r.readInt(4)?null:n.utf8decode(r.readData(t.length-5))}return null},findExtraFieldUnicodeComment:function(){var t=this.extraFields[25461];if(t){var r=e(t.value);return 1!==r.readInt(1)?null:i(this.fileComment)!==r.readInt(4)?null:n.utf8decode(r.readData(t.length-5))}return null}},a}),e("skylark-jszip/zipEntries",["./reader/readerFor","./utils","./signature","./zipEntry","./support"],function(e,t,r,i,n){"use strict";function s(e){this.files=[],this.loadOptions=e}return s.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var r=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+t.pretty(r)+", expected "+t.pretty(e)+")")}},isSignature:function(e,t){var r=this.reader.index;this.reader.setIndex(e);var i=this.reader.readString(4),n=i===t;return this.reader.setIndex(r),n},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),r=n.uint8array?"uint8array":"array",i=t.transformTo(r,e);this.zipComment=this.loadOptions.decodeFileName(i)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,r,i=this.zip64EndOfCentralSize-44;0<i;)e=this.reader.readInt(2),t=this.reader.readInt(4),r=this.reader.readData(t),this.zip64ExtensibleData[e]={id:e,length:t,value:r}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(r.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(r.CENTRAL_FILE_HEADER);)(e=new i({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(r.CENTRAL_DIRECTORY_END);if(e<0){var i=!this.isSignature(0,r.LOCAL_FILE_HEADER);throw i?new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip: can't find end of central directory")}this.reader.setIndex(e);var n=e;if(this.checkSignature(r.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===t.MAX_VALUE_16BITS||this.diskWithCentralDirStart===t.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===t.MAX_VALUE_16BITS||this.centralDirRecords===t.MAX_VALUE_16BITS||this.centralDirSize===t.MAX_VALUE_32BITS||this.centralDirOffset===t.MAX_VALUE_32BITS){if(this.zip64=!0,(e=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,r.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var s=this.centralDirOffset+this.centralDirSize;this.zip64&&(s+=20,s+=12+this.zip64EndOfCentralSize);var o=n-s;if(o>0)this.isSignature(n,r.CENTRAL_FILE_HEADER)||(this.reader.zero=o);else if(o<0)throw new Error("Corrupted zip: missing "+Math.abs(o)+" bytes.")},prepareReader:function(t){this.reader=e(t)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},s}),e("skylark-jszip/load",["./utils","./external","./utf8","./zipEntries","./stream/Crc32Probe"],function(e,t,r,i,n){"use strict";function s(e){return new t.Promise(function(t,r){var i=e.decompressed.getContentWorker().pipe(new n);i.on("error",function(e){r(e)}).on("end",function(){i.streamInfo.crc32!==e.decompressed.crc32?r(new Error("Corrupted zip : CRC32 mismatch")):t()}).resume()})}return function(n,o){var a=this;return o=e.extend(o||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:r.utf8decode}),e.prepareContent("the loaded zip file",n,!0,o.optimizedBinaryString,o.base64).then(function(e){var t=new i(o);return t.load(e),t}).then(function(e){var r=[t.Promise.resolve(e)],i=e.files;if(o.checkCRC32)for(var n=0;n<i.length;n++)r.push(s(i[n]));return t.Promise.all(r)}).then(function(t){for(var r=t.shift(),i=r.files,n=0;n<i.length;n++){var s=i[n],u=s.fileNameStr,h=e.resolve(s.fileNameStr);a.file(h,s.decompressed,{binary:!0,optimizedBinaryString:!0,date:s.date,dir:s.dir,comment:s.fileCommentStr.length?s.fileCommentStr:null,unixPermissions:s.unixPermissions,dosPermissions:s.dosPermissions,createFolders:o.createFolders}),s.dir||(a.file(h).unsafeOriginalName=u)}return r.zipComment.length&&(a.comment=r.zipComment),a})}}),e("skylark-jszip/JSZip",["./object","./load","./support","./defaults","./external"],function(e,t,r,i,n){"use strict";function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var e=new s;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e}}return s.prototype=e,s.prototype.loadAsync=t,s.support=r,s.defaults=i,s.version="3.10.1",s.loadAsync=function(e,t){return(new s).loadAsync(e,t)},s.external=n,s}),e("skylark-jszip/main",["skylark-langx-ns","./JSZip"],function(e,t){var r=function(e,r){var i=new t;return arguments.length>0?i.loadAsync(e,r):i};return r.ZipFile=t,e.attach("intg.jszip",r)}),e("skylark-jszip",["skylark-jszip/main"],function(e){return e})}(r),!i){var o=require("skylark-langx-ns");n?module.exports=o:t.skylarkjs=o}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-jszip.js.map
